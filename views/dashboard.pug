extends layout

block content
  .banner
    img(src="/img/banner-libreria.webp" alt="Banner librería" class="banner-img")
    .bienvenida-box
      h2 Bienvenido a El Lector Voraz
      if proveedores
        p ¡Gestiona fácilmente tus proveedores y fortalece tu red de abastecimiento!
      else
        p ¡Gestiona tu negocio de la forma más eficiente!
  .dashboard-container
    aside.sidebar
      .sidebar-header
        img(src="/img/logo-lector-voraz.png", alt="Logo", class="sidebar-logo" style="display:block;margin:0 auto 12px auto;width:90px;")
        h2 El Lector Voraz        
      nav.sidebar-nav
        ul
          li
            a(href="/inicio")
              i.fas.fa-home(style="margin-right:8px;")
              | Inicio
          li
            a(href="/libros")
              i.fas.fa-book(style="margin-right:8px;")
              | Libros
          li
            a(href="/cafeteria")
              i.fas.fa-mug-hot(style="margin-right:8px;")
              | Cafetería
          li
            a(href="/utileria")
              i.fas.fa-pencil-ruler(style="margin-right:8px;")
              | Utilería
          if user && user.rol === 'admin'
            li
              a(href="/proveedores")
                i.fas.fa-truck(style="margin-right:8px;")
                | Proveedores
          li
            a(href="/usuarios")
              i.fas.fa-users(style="margin-right:8px;")
              | Usuarios
    main.main-panel
      if libros
        .main-header(style="display:flex;justify-content:space-between;align-items:center;")
          h1 Libros
          .user-info(style="display:flex;align-items:center;gap:12px;")
            if user
              span #{user.nombre} (#{user.rol === 'admin' ? 'Administrador' : 'Empleado'})
            else
              span Usuario
            button.logout-btn(type="button" onclick="window.location.href='/auth/logout'") Cerrar Sesión
        .menu-grupo.menu-grupo-horizontal
          .menu-icon
            i.fas.fa-book.fa-2x
          h3 Libros
          ul.menu-horizontal
            li: a.button(href="/libros/catalogo") Catálogo de libros
            if user && user.rol === 'admin'
              li: a.button(href="/libros/nuevo") Agregar libro
            li: a.button(href="/libros/ventas/nueva") Registrar venta
            li: a.button(href="/libros/ventas/reportes") Reporte de ventas
        .main-header
          h2 Proveedores
      else if proveedores
        .main-header(style="display:flex;justify-content:space-between;align-items:center;")
          h1 Proveedores
          .user-info(style="display:flex;align-items:center;gap:12px;")
            if user
              span #{user.nombre} (#{user.rol === 'admin' ? 'Administrador' : 'Empleado'})
            else
              span Usuario
            button.logout-btn(type="button" onclick="window.location.href='/auth/logout'") Cerrar Sesión
        .menu-grupo.menu-grupo-horizontal
          .menu-icon
            i.fas.fa-truck.fa-2x
          h3 Proveedores
          ul.menu-horizontal
            li: a.button(class=(activeMenu === 'catalogo' ? 'active' : ''), href="/proveedores") Catálogo de proveedores
            if user && user.rol === 'admin'
              li: a.button(class=(activeMenu === 'nuevo' ? 'active' : ''), href="/proveedores/nuevo") Agregar proveedor
        if activeMenu === 'nuevo'
          .nuevo-proveedor-content(style="background:#F2F0EC;padding:32px 0 24px 0;display:flex;flex-direction:column;align-items:center;")
            .form-box(style="background:#fff;padding:32px 20px 28px 20px;border-radius:12px;box-shadow:0 2px 12px rgba(60,60,60,0.07);max-width:400px;width:100%;display:flex;flex-direction:column;align-items:center;")
              h1(style="color:#675858;font-size:1.4rem;text-align:center;margin-bottom:18px;") Nuevo Proveedor
              form#form-nuevo-proveedor(method="post" style="width:100%;max-width:320px;display:flex;flex-direction:column;gap:14px;")
                div
                  label(for="nombre" style="color:#675858;font-size:1rem;margin-bottom:4px;") Nombre:
                  input(type="text" name="nombre" id="nombre" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="mail" style="color:#675858;font-size:1rem;margin-bottom:4px;") Email:
                  input(type="email" name="mail" id="mail" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="tipo_proveedor" style="color:#675858;font-size:1rem;margin-bottom:4px;") Tipo de proveedor:
                  select(name="tipo_proveedor" id="tipo_proveedor" required class="input-lg" style="width:100%;margin-bottom:10px;")
                    option(value="libreria") Librería
                    option(value="cafeteria") Cafetería
                    option(value="utileria") Utilería
                div
                  label(for="telefono" style="color:#675858;font-size:1rem;margin-bottom:4px;") Teléfono:
                  input(type="text" name="telefono" id="telefono" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="sitio_web" style="color:#675858;font-size:1rem;margin-bottom:4px;") Sitio web:
                  input(type="url" name="sitio_web" id="sitio_web" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:18px;border-radius:6px;border:1px solid #ccc;")
                div
                  button(type="submit" class="button button-lg" style="width:100%;margin-top:8px;font-size:1.1rem;padding:10px 0;") Guardar
            .catalogo-actions(style="display:flex;justify-content:center;margin-top:18px;")
              a.button(href="/inicio") Volver al inicio
            script(src="/js/proveedores/nuevo_proveedor.js")
        else if activeMenu === 'editar'
          .editar-proveedor-content(style="background:#F2F0EC;padding:32px 0 24px 0;display:flex;flex-direction:column;align-items:center;")
            .form-box(style="background:#fff;padding:32px 20px 28px 20px;border-radius:12px;box-shadow:0 2px 12px rgba(60,60,60,0.07);max-width:400px;width:100%;display:flex;flex-direction:column;align-items:center;")
              h1(style="color:#675858;font-size:1.4rem;text-align:center;margin-bottom:18px;") Editar Proveedor
              form#form-editar-proveedor(method="post" style="width:100%;max-width:320px;display:flex;flex-direction:column;gap:14px;")
                div
                  label(for="nombre" style="color:#675858;font-size:1rem;margin-bottom:4px;") Nombre:
                  input(type="text" name="nombre" id="nombre" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="mail" style="color:#675858;font-size:1rem;margin-bottom:4px;") Email:
                  input(type="email" name="mail" id="mail" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="tipo_proveedor" style="color:#675858;font-size:1rem;margin-bottom:4px;") Tipo de proveedor:
                  select(name="tipo_proveedor" id="tipo_proveedor" required class="input-lg" style="width:100%;margin-bottom:10px;")
                    option(value="libreria") Librería
                    option(value="cafeteria") Cafetería
                    option(value="utileria") Utilería
                div
                  label(for="telefono" style="color:#675858;font-size:1rem;margin-bottom:4px;") Teléfono:
                  input(type="text" name="telefono" id="telefono" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="sitio_web" style="color:#675858;font-size:1rem;margin-bottom:4px;") Sitio web:
                  input(type="url" name="sitio_web" id="sitio_web" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:18px;border-radius:6px;border:1px solid #ccc;")
                div
                  button(type="submit" class="button button-lg" style="width:100%;margin-top:8px;font-size:1.1rem;padding:10px 0;") Guardar cambios
              script(src="/js/proveedores/editar_proveedor.js")
              script.
                document.addEventListener('DOMContentLoaded', async () => {
                  const id = window.location.pathname.split('/').pop();
                  try {
                    const resp = await fetch(`/api/proveedores/${id}`);
                    if (resp.ok) {
                      const proveedor = await resp.json();
                      document.getElementById('nombre').value = proveedor.nombre || '';
                      document.getElementById('mail').value = proveedor.mail || '';
                      document.getElementById('tipo_proveedor').value = proveedor.tipo_proveedor || 'libreria';
                      document.getElementById('telefono').value = proveedor.telefono || '';
                      document.getElementById('sitio_web').value = proveedor.sitio_web || '';
                    } else {
                      alert('No se pudo cargar el proveedor');
                    }
                  } catch (e) {
                    alert('Error de red al cargar proveedor');
                  }
                });
        else
          section.catalogo-content(style="background:#F2F0EC;padding:32px 0 24px 0;")
            table(style="background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 12px rgba(60,60,60,0.07);")
              thead
                tr
                  th Nombre
                  th Tipo
                  th Mail
                  th Teléfono
                  th Web
                  th Acciones
              tbody#tabla-proveedores
                tr
                  td(colspan="6") Cargando proveedores...
            .catalogo-actions(style="display:flex;justify-content:center;margin-top:18px;")
              a.button(href="/inicio") Volver al inicio
            script(src="/js/proveedores/catalogo_proveedores.js")
      else if usuarios
        .main-header(style="display:flex;justify-content:space-between;align-items:center;")
          h1 Usuarios
          .user-info(style="display:flex;align-items:center;gap:12px;")
            if user
              span #{user.nombre} (#{user.rol === 'admin' ? 'Administrador' : 'Empleado'})
            else
              span Usuario
            button.logout-btn(type="button" onclick="window.location.href='/auth/logout'") Cerrar Sesión
        .menu-grupo.menu-grupo-horizontal
          .menu-icon
            i.fas.fa-users.fa-2x
          h3 Usuarios
          ul.menu-horizontal
            li: a.button(class=(activeMenu === 'catalogo' ? 'active' : ''), href="/usuarios") 
              if user && user.rol === 'admin'
                | Catálogo de usuarios
              else
                | Mi perfil
            if user && user.rol === 'admin'
              li: a.button(class=(activeMenu === 'nuevo' ? 'active' : ''), href="/usuarios/nuevo") Agregar usuario
        if activeMenu === 'nuevo'
          .nuevo-usuario-content(style="background:#F2F0EC;padding:32px 0 24px 0;display:flex;flex-direction:column;align-items:center;")
            .form-box(style="background:#fff;padding:32px 20px 28px 20px;border-radius:12px;box-shadow:0 2px 12px rgba(60,60,60,0.07);max-width:400px;width:100%;display:flex;flex-direction:column;align-items:center;")
              h1(style="color:#675858;font-size:1.4rem;text-align:center;margin-bottom:18px;") Nuevo Usuario
              form#form-nuevo-usuario(method="post" style="width:100%;max-width:320px;display:flex;flex-direction:column;gap:14px;")
                div
                  label(for="nombre" style="color:#675858;font-size:1rem;margin-bottom:4px;") Nombre:
                  input(type="text" name="nombre" id="nombre" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="email" style="color:#675858;font-size:1rem;margin-bottom:4px;") Email:
                  input(type="email" name="email" id="email" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="password" style="color:#675858;font-size:1rem;margin-bottom:4px;") Contraseña:
                  input(type="password" name="password" id="password" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="rol" style="color:#675858;font-size:1rem;margin-bottom:4px;") Rol:
                  select(name="rol" id="rol" required class="input-lg" style="width:100%;margin-bottom:10px;")
                    option(value="empleado") Empleado
                    option(value="vendedor") Vendedor
                    option(value="admin") Administrador
                div
                  label(for="telefono" style="color:#675858;font-size:1rem;margin-bottom:4px;") Teléfono:
                  input(type="text" name="telefono" id="telefono" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:18px;border-radius:6px;border:1px solid #ccc;")
                div
                  button(type="submit" class="button button-lg" style="width:100%;margin-top:8px;font-size:1.1rem;padding:10px 0;") Guardar
            .catalogo-actions(style="display:flex;justify-content:center;margin-top:18px;")
              a.button(href="/inicio") Volver al inicio
            script(src="/js/usuarios/nuevo_usuario.js")
        else if activeMenu === 'editar'
          .editar-usuario-content(style="background:#F2F0EC;padding:32px 0 24px 0;display:flex;flex-direction:column;align-items:center;")
            .form-box(style="background:#fff;padding:32px 20px 28px 20px;border-radius:12px;box-shadow:0 2px 12px rgba(60,60,60,0.07);max-width:400px;width:100%;display:flex;flex-direction:column;align-items:center;")
              h1(style="color:#675858;font-size:1.4rem;text-align:center;margin-bottom:18px;") Editar Usuario
              form#form-editar-usuario(method="post" style="width:100%;max-width:320px;display:flex;flex-direction:column;gap:14px;")
                div
                  label(for="nombre" style="color:#675858;font-size:1rem;margin-bottom:4px;") Nombre:
                  input(type="text" name="nombre" id="nombre" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="email" style="color:#675858;font-size:1rem;margin-bottom:4px;") Email:
                  input(type="email" name="email" id="email" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="password" style="color:#675858;font-size:1rem;margin-bottom:4px;") Nueva Contraseña (opcional):
                  input(type="password" name="password" id="password" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="rol" style="color:#675858;font-size:1rem;margin-bottom:4px;") Rol:
                  select(name="rol" id="rol" required class="input-lg" style="width:100%;margin-bottom:10px;")
                    option(value="empleado") Empleado
                    option(value="vendedor") Vendedor
                    option(value="admin") Administrador
                div
                  label(for="telefono" style="color:#675858;font-size:1rem;margin-bottom:4px;") Teléfono:
                  input(type="text" name="telefono" id="telefono" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:18px;border-radius:6px;border:1px solid #ccc;")
                div
                  button(type="submit" class="button button-lg" style="width:100%;margin-top:8px;font-size:1.1rem;padding:10px 0;") Guardar cambios
              script(src="/js/usuarios/editar_usuario.js")
              script.
                document.addEventListener('DOMContentLoaded', async () => {
                  const id = window.location.pathname.split('/').pop();
                  try {
                    const resp = await fetch(`/api/usuarios/${id}`);
                    if (resp.ok) {
                      const usuario = await resp.json();
                      document.getElementById('nombre').value = usuario.nombre || '';
                      document.getElementById('email').value = usuario.email || '';
                      document.getElementById('rol').value = usuario.rol || 'empleado';
                      document.getElementById('telefono').value = usuario.telefono || '';
                    } else {
                      alert('No se pudo cargar el usuario');
                    }
                  } catch (e) {
                    alert('Error de red al cargar usuario');
                  }
                });
        else
          section.catalogo-content(style="background:#F2F0EC;padding:32px 0 24px 0;")
            table(style="background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 12px rgba(60,60,60,0.07);")
              thead
                tr
                  th Nombre
                  th Email
                  th Rol
                  th Teléfono
                  th Estado
                  th Fecha Creación
                  th Acciones
              tbody#tabla-usuarios
                tr
                  td(colspan="7") Cargando usuarios...
            .catalogo-actions(style="display:flex;justify-content:center;margin-top:18px;")
              a.button(href="/inicio") Volver al inicio
            script(src="/js/usuarios/catalogo_usuarios.js")
      else if utileria
        .main-header(style="display:flex;justify-content:space-between;align-items:center;")
          h1 Utilería
          .user-info(style="display:flex;align-items:center;gap:12px;")
              if user
                span #{user.nombre} (#{user.rol === 'admin' ? 'Administrador' : 'Empleado'})
              else
                span Usuario
              button.logout-btn(type="button" onclick="window.location.href='/auth/logout'") Cerrar Sesión
          .menu-grupo.menu-grupo-horizontal
          .menu-icon
            i.fas.fa-pencil-ruler.fa-2x
          h3 Utilería
          ul.menu-horizontal
            li: a.button(class=(activeMenu === 'catalogo' ? 'active' : ''), href="/utileria") Catálogo de utilería
            if user && user.rol === 'admin'
              li: a.button(class=(activeMenu === 'nuevo' ? 'active' : ''), href="/utileria/nuevo") Agregar utilería
            li: a.button(class=(activeMenu === 'vender' ? 'active' : ''), href="/utileria/vender") Registrar venta
            li: a.button(class=(activeMenu === 'reportes' ? 'active' : ''), href="/utileria/reportes") Reporte de ventas
        if activeMenu === 'nuevo'
          .nuevo-utileria-content(style="background:#F2F0EC;padding:32px 0 24px 0;display:flex;flex-direction:column;align-items:center;")
            .form-box(style="background:#fff;padding:32px 20px 28px 20px;border-radius:12px;box-shadow:0 2px 12px rgba(60,60,60,0.07);max-width:400px;width:100%;display:flex;flex-direction:column;align-items:center;")
              h1(style="color:#675858;font-size:1.4rem;text-align:center;margin-bottom:18px;") Nueva Utilería
              form#form-nuevo-utileria(method="post" style="width:100%;max-width:320px;display:flex;flex-direction:column;gap:14px;")
                div
                  label(for="nombre" style="color:#675858;font-size:1rem;margin-bottom:4px;") Nombre:
                  input(type="text" name="nombre" id="nombre" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="descripcion" style="color:#675858;font-size:1rem;margin-bottom:4px;") Descripción:
                  textarea(name="descripcion" id="descripcion" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;min-height:80px;")
                div
                  label(for="precio" style="color:#675858;font-size:1rem;margin-bottom:4px;") Precio:
                  input(type="number" name="precio" id="precio" required min="0" step="0.01" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="stock" style="color:#675858;font-size:1rem;margin-bottom:4px;") Stock:
                  input(type="number" name="stock" id="stock" required min="0" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="stockMinimo" style="color:#675858;font-size:1rem;margin-bottom:4px;") Stock Mínimo:
                  input(type="number" name="stockMinimo" id="stockMinimo" required min="0" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="proveedor" style="color:#675858;font-size:1rem;margin-bottom:4px;") Proveedor:
                  select(name="proveedor" id="proveedor" required class="input-lg" style="width:100%;margin-bottom:18px;")
                    option(value="") Seleccione un proveedor
                    if proveedoresUtileria
                      each proveedor in proveedoresUtileria
                        option(value=proveedor._id) #{proveedor.nombre}
                div
                  button(type="submit" class="button button-lg" style="width:100%;margin-top:8px;font-size:1.1rem;padding:10px 0;") Guardar
            .catalogo-actions(style="display:flex;justify-content:center;margin-top:18px;")
              a.button(href="/inicio") Volver al inicio
            script(src="/js/utileria/nuevo_utileria.js")
        else if activeMenu === 'editar'
          .editar-utileria-content(style="background:#F2F0EC;padding:32px 0 24px 0;display:flex;flex-direction:column;align-items:center;")
            .form-box(style="background:#fff;padding:32px 20px 28px 20px;border-radius:12px;box-shadow:0 2px 12px rgba(60,60,60,0.07);max-width:400px;width:100%;display:flex;flex-direction:column;align-items:center;")
              h1(style="color:#675858;font-size:1.4rem;text-align:center;margin-bottom:18px;") Editar Utilería
              form#form-editar-utileria(method="post" style="width:100%;max-width:320px;display:flex;flex-direction:column;gap:14px;")
                div
                  label(for="nombre" style="color:#675858;font-size:1rem;margin-bottom:4px;") Nombre:
                  input(type="text" name="nombre" id="nombre" required class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="descripcion" style="color:#675858;font-size:1rem;margin-bottom:4px;") Descripción:
                  textarea(name="descripcion" id="descripcion" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;min-height:80px;")
                div
                  label(for="precio" style="color:#675858;font-size:1rem;margin-bottom:4px;") Precio:
                  input(type="number" name="precio" id="precio" required min="0" step="0.01" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="stock" style="color:#675858;font-size:1rem;margin-bottom:4px;") Stock:
                  input(type="number" name="stock" id="stock" required min="0" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="stockMinimo" style="color:#675858;font-size:1rem;margin-bottom:4px;") Stock Mínimo:
                  input(type="number" name="stockMinimo" id="stockMinimo" required min="0" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="proveedor" style="color:#675858;font-size:1rem;margin-bottom:4px;") Proveedor:
                  select(name="proveedor" id="proveedor" required class="input-lg" style="width:100%;margin-bottom:18px;")
                    if proveedoresUtileria
                      each proveedor in proveedoresUtileria
                        option(value=proveedor._id) #{proveedor.nombre}
                div
                  button(type="submit" class="button button-lg" style="width:100%;margin-top:8px;font-size:1.1rem;padding:10px 0;") Guardar cambios
              script(src="/js/utileria/editar_utileria.js")
              script.
                document.addEventListener('DOMContentLoaded', async () => {
                  const id = window.location.pathname.split('/').pop();
                  try {
                    const resp = await fetch(`/api/utileria/${id}`);
                    if (resp.ok) {
                      const utileria = await resp.json();
                      document.getElementById('nombre').value = utileria.nombre || '';
                      document.getElementById('descripcion').value = utileria.descripcion || '';
                      document.getElementById('precio').value = utileria.precio || '';
                      document.getElementById('stock').value = utileria.stock || '';
                      document.getElementById('stockMinimo').value = utileria.stockMinimo || '';
                      document.getElementById('proveedor').value = utileria.proveedor || '';
                    } else {
                      alert('No se pudo cargar la utilería');
                    }
                  } catch (e) {
                    alert('Error de red al cargar utilería');
                  }
                });
        else if activeMenu === 'vender'
          .vender-utileria-content(style="background:#F2F0EC;padding:32px 0 24px 0;display:flex;flex-direction:column;align-items:center;")
            .form-box(style="background:#fff;padding:32px 20px 28px 20px;border-radius:12px;box-shadow:0 2px 12px rgba(60,60,60,0.07);max-width:400px;width:100%;display:flex;flex-direction:column;align-items:center;")
              h1(style="color:#675858;font-size:1.4rem;text-align:center;margin-bottom:18px;") Registrar Venta de Utilería
              form#form-nueva-venta-utileria(method="post" style="width:100%;max-width:320px;display:flex;flex-direction:column;gap:14px;")
                div
                  label(for="utileriaId" style="color:#675858;font-size:1rem;margin-bottom:4px;") Utilería:
                  select(name="utileriaId" id="utileriaId" required class="input-lg" style="width:100%;margin-bottom:10px;")
                    option(value="") Seleccione una utilería
                div
                  label(for="precio-utileria" style="color:#675858;font-size:1rem;margin-bottom:4px;") Precio unitario:
                  input(type="text" id="precio-utileria" readonly class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;background:#f9f9f9;")
                div
                  label(for="cantidad" style="color:#675858;font-size:1rem;margin-bottom:4px;") Cantidad:
                  input(type="number" name="cantidad" id="cantidad" required min="1" class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;")
                div
                  label(for="total-venta" style="color:#675858;font-size:1rem;margin-bottom:4px;") Total:
                  input(type="text" id="total-venta" readonly class="input-lg" style="width:100%;padding:10px 12px;margin-bottom:18px;border-radius:6px;border:1px solid #ccc;background:#f9f9f9;")
                div
                  button(type="submit" class="button button-lg" style="width:100%;margin-top:8px;font-size:1.1rem;padding:10px 0;") Registrar Venta
            .catalogo-actions(style="display:flex;justify-content:center;margin-top:18px;")
              a.button(href="/inicio") Volver al inicio
            script(src="/js/utileria/vender_utileria.js")
            script.
              document.addEventListener('DOMContentLoaded', async () => {
                const select = document.getElementById('utileriaId');
                try {
                  // Cargar todos los productos de utilería
                  const resp = await fetch('/api/utileria');
                  if (resp.ok) {
                    const utileria = await resp.json();
                    utileria.forEach(item => {
                      const option = document.createElement('option');
                      option.value = item._id;
                      option.textContent = `${item.nombre} - $${item.precio}`;
                      option.setAttribute('data-precio', item.precio);
                      select.appendChild(option);
                    });
                    
                    // Si hay un producto preseleccionado desde la URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const utileriaIdFromUrl = urlParams.get('utileria');
                    if (utileriaIdFromUrl) {
                      select.value = utileriaIdFromUrl;
                      // Disparar el evento change para actualizar precio y total
                      select.dispatchEvent(new Event('change'));
                    }
                  }
                } catch (e) {
                  console.error('Error cargando utilería:', e);
                }
              });
        else if activeMenu === 'reportes'
          .reportes-utileria-content(style="background:#F2F0EC;padding:32px 0 24px 0;")
            h2(style="text-align:center;margin-bottom:24px;color:#675858;") Reportes de Ventas de Utilería
            .filtros-container(style="display:flex;justify-content:center;margin-bottom:20px;")
              div(style="display:flex;align-items:center;gap:10px;")
                label(for="filtro-fecha" style="color:#675858;font-weight:600;") Filtrar por:
                select#filtro-fecha(style="padding:8px 12px;border:1px solid #ccc;border-radius:6px;background:#fff;")
                  option(value="todo") Todas las ventas
                  option(value="dia") Hoy
                  option(value="semana") Esta semana
                  option(value="mes") Este mes
            .tabla-container(style="background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 12px rgba(60,60,60,0.07);max-width:1000px;margin:0 auto;")
              table(style="width:100%;")
                thead
                  tr
                    th(style="padding:12px;background:#f5f5f5;border-bottom:1px solid #ddd;") Fecha
                    th(style="padding:12px;background:#f5f5f5;border-bottom:1px solid #ddd;") Producto
                    th(style="padding:12px;background:#f5f5f5;border-bottom:1px solid #ddd;") Descripción
                    th(style="padding:12px;background:#f5f5f5;border-bottom:1px solid #ddd;") Precio Unit.
                    th(style="padding:12px;background:#f5f5f5;border-bottom:1px solid #ddd;") Cantidad
                    th(style="padding:12px;background:#f5f5f5;border-bottom:1px solid #ddd;") Total
                    th(style="padding:12px;background:#f5f5f5;border-bottom:1px solid #ddd;text-align:center;") Acciones
                tbody
                  tr
                    td(colspan="7" style="padding:20px;text-align:center;color:#888;") Cargando reportes de ventas...
                tfoot
            .catalogo-actions(style="display:flex;justify-content:center;margin-top:18px;")
              a.button(href="/inicio") Volver al inicio
            script(src="/js/utileria/reportes_ventas_utileria.js")
        else
          section.catalogo-content(style="background:#F2F0EC;padding:32px 0 24px 0;")
            table(style="background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 12px rgba(60,60,60,0.07);")
              thead
                tr
                  th Nombre
                  th Descripción
                  th Precio
                  th Stock
                  th Stock Mínimo
                  th Proveedor
                  th Acciones
              tbody#tabla-utileria
                tr
                  td(colspan="7") Cargando utilería...
            .catalogo-actions(style="display:flex;justify-content:center;margin-top:18px;")
              a.button(href="/inicio") Volver al inicio
            script(src="/js/utileria/catalogo_utileria.js")
      else
        .main-header(style="display:flex;justify-content:space-between;align-items:center;")
          h1 Panel Principal
          .user-info(style="display:flex;align-items:center;gap:12px;")
            if user
              span #{user.nombre} (#{user.rol === 'admin' ? 'Administrador' : 'Empleado'})
            else
              span Usuario
            button.logout-btn(type="button" onclick="window.location.href='/auth/logout'") Cerrar Sesión
        .dashboard-cards
          .card.card-stock
            h3 Alertas 
              i.fas.fa-exclamation-triangle(style="margin-left:8px;color:#ff6b35;")
            ul(style="max-height:260px;overflow-y:auto;padding-right:8px;")
              if alertasStock && alertasStock.length
                each alerta in alertasStock
                  if alerta.includes('Libro:')
                    if alerta.includes('Agotado')
                      li.venta(style="color:#e57373;background:#ffebee;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-book(style="margin-right:6px;color:#c62828;")
                        | #{alerta.replace('Libro: ', '')}
                    else if alerta.includes('Solo')
                      li.venta(style="color:#ffb74d;background:#fff3e0;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-book(style="margin-right:6px;color:#fbc02d;")
                        | #{alerta.replace('Libro: ', '')}
                    else if alerta.includes('reposici')
                      li.venta(style="color:#ba68c8;background:#f3e5f5;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-book(style="margin-right:6px;color:#8e24aa;")
                        | #{alerta.replace('Libro: ', '')}
                    else if alerta.includes('No se vende hace más de 6 meses')
                      li.venta(style="color:#64b5f6;background:#e3f2fd;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-book(style="margin-right:6px;color:#1976d2;")
                        | #{alerta.replace('Libro: ', '')}
                    else
                      li.venta= alerta
                  else if alerta.includes('Utilería:')
                    if alerta.includes('Agotado')
                      li.venta(style="color:#e57373;background:#ffebee;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-pencil-ruler(style="margin-right:6px;color:#c62828;")
                        | #{alerta.replace('Utilería: ', '')}
                    else if alerta.includes('Solo')
                      li.venta(style="color:#ffb74d;background:#fff3e0;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-pencil-ruler(style="margin-right:6px;color:#fbc02d;")
                        | #{alerta.replace('Utilería: ', '')}
                    else if alerta.includes('reposici')
                      li.venta(style="color:#64b5f6;background:#e3f2fd;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-pencil-ruler(style="margin-right:6px;color:#1976d2;")
                        | #{alerta.replace('Utilería: ', '')}
                    else if alerta.includes('No se vende hace más de 6 meses')
                      li.venta(style="color:#64b5f6;background:#e3f2fd;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-pencil-ruler(style="margin-right:6px;color:#1976d2;")
                        | #{alerta.replace('Utilería: ', '')}
                    else
                      li.venta= alerta
                  else if alerta.includes('Cafetería:')
                    if alerta.includes('Agotado')
                      li.venta(style="color:#e57373;background:#ffebee;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-mug-hot(style="margin-right:6px;color:#c62828;")
                        | #{alerta.replace('Cafetería: ', '')}
                    else if alerta.includes('Solo')
                      li.venta(style="color:#ffb74d;background:#fff3e0;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-mug-hot(style="margin-right:6px;color:#fbc02d;")
                        | #{alerta.replace('Cafetería: ', '')}
                    else if alerta.includes('reposici')
                      li.venta(style="color:#81c784;background:#e8f5e8;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-mug-hot(style="margin-right:6px;color:#4caf50;")
                        | #{alerta.replace('Cafetería: ', '')}
                    else if alerta.includes('No se vende hace más de 6 meses')
                      li.venta(style="color:#64b5f6;background:#e3f2fd;border-radius:6px;padding:4px 8px;margin-bottom:4px;font-weight:bold;")
                        i.fas.fa-mug-hot(style="margin-right:6px;color:#1976d2;")
                        | #{alerta.replace('Cafetería: ', '')}
                    else
                      li.venta= alerta
                  else
                    li.venta= alerta
              else
                li.venta Sin alertas de stock
          .card.card-ventas
            h3 Ventas Recientes 
              i.fas.fa-shopping-cart(style="margin-left:8px;color:#000;")
            ul#ventas-recientes(style="max-height:260px;overflow-y:auto;padding-right:8px;")
              if ultimasVentas && ultimasVentas.length
                each v in ultimasVentas
                  li.venta
                    if v.tipo === 'libro' || v.tipo === 'Libro' || (v.autor && v.autor !== '-')
                      i.fas.fa-book(style="margin-right:6px;color:#000;")
                      | #{v.nombre} ×#{v.cantidad} - #{v.autor || 'N/A'} ($#{v.monto})
                    else if v.tipo === 'cafeteria' || v.tipo === 'Cafetería'
                      i.fas.fa-mug-hot(style="margin-right:6px;color:#000;")
                      | #{v.nombre} ×#{v.cantidad} - #{v.autor || 'N/A'} ($#{v.monto})
                    else
                      i.fas.fa-pencil-ruler(style="margin-right:6px;color:#000;")
                      | #{v.nombre} ×#{v.cantidad} - #{v.autor || 'N/A'} ($#{v.monto})
              else
                li.venta No hay ventas recientes
            .total-ventas Total del día: 
              span.total#total-ventas $#{totalVentas}
        .dashboard-actions(style="display:flex;flex-direction:row;align-items:center;gap:16px;justify-content:center;margin-top:24px;")
          .dropdown
            button.button#ventaRapidaBtn(type="button") 
              i.fas.fa-bolt(style="margin-right:6px;color:#ff6b35;")
              | Venta Rápida
            ul.dropdown-menu#ventaRapidaMenu(style="display:none;")
              li: a(href="/libros/ventas/nueva" style="display:flex;align-items:center;gap:8px;font-size:1rem;padding:8px 18px;font-family:inherit;font-weight:500;color:#8b4513;text-decoration:none;")
                i.fas.fa-book(style="font-size:1.1em;margin-right:4px;")
                | Vender Libro
              li: a(href="/utileria/vender" style="display:flex;align-items:center;gap:8px;font-size:1rem;padding:8px 18px;font-family:inherit;font-weight:500;color:#8b4513;text-decoration:none;")
                i.fas.fa-pencil-ruler(style="font-size:1.1em;margin-right:4px;")
                | Vender Utilería
              li: a(href="/cafeteria/vender" style="display:flex;align-items:center;gap:8px;font-size:1rem;padding:8px 18px;font-family:inherit;font-weight:500;color:#8b4513;text-decoration:none;")
                i.fas.fa-mug-hot(style="font-size:1.1em;margin-right:4px;")
                | Vender Cafetería
          a.button.dashboard-btn(href="/libros/nuevo") 
            i.fas.fa-book-open(style="margin-right:6px;color:#8e24aa;")
            | Nuevo Libro
          a.button.dashboard-btn(href="/cafeteria/nuevo") 
            i.fas.fa-coffee(style="margin-right:6px;color:#8b4513;")
            | Nuevo Cafetería
          a.button.dashboard-btn(href="/utileria/nuevo") 
            i.fas.fa-pen(style="margin-right:6px;color:#1976d2;")
            | Nuevo Utilería
          a.button.dashboard-btn(href="/proveedores") 
            i.fas.fa-truck-loading(style="margin-right:6px;color:#4caf50;")
            | Nuevo Proveedor
          button.button.dashboard-btn(type="button" onclick="window.location.href='/usuarios/nuevo'") 
            i.fas.fa-user-plus(style="margin-right:6px;color:#ff9800;")
            | Nuevo Usuario
    script.
      const btn = document.getElementById('ventaRapidaBtn');
      const menu = document.getElementById('ventaRapidaMenu');
      btn && btn.addEventListener('click', function() {
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
      });
      document.addEventListener('click', function(e) {
        if (btn && !btn.contains(e.target) && menu && !menu.contains(e.target)) {
          menu.style.display = 'none';
        }
      });
    script.
      window.addEventListener('DOMContentLoaded', function() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('proveedores_libros')) {
          const alerta = document.createElement('div');
          alerta.className = 'alerta-exito';
          alerta.style = 'background:#D1F5D3;color:#256029;padding:12px 18px 8px 18px;border-radius:8px;margin:18px auto 0 auto;max-width:400px;text-align:center;font-size:1.1rem;position:relative;';
          alerta.innerHTML = '¡Proveedor de libros eliminado exitosamente!<br><button type="button" class="button" style="margin-top:10px;min-width:80px;" onclick="this.parentNode.remove()">OK</button>';
          document.body.insertBefore(alerta, document.body.firstChild);
          params.delete('proveedores_libros');
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      });
    script(src="/js/dashboard.js")
  footer
    hr
    p Trabajo Integrador 2° entrega  – Desarrollo Web Backend – IFTS 29
    p Grupo "El Quinto Elemento" -  Clausi, Descosido, Gill
